{% extends "base.html" %}
{% block content %}
<h2>Недельный план (общий обзор)</h2>

<form method="get" action="/week" class="row">
  <label>Дата:</label>
  <input type="date" name="d" value="{{ date }}">
  <button type="submit">Показать неделю</button>
</form>

<h3>Факт по дням (часы)</h3>
<table>
  <thead>
    <tr>
      <th>Сотрудник</th>
      {% for day in days %}
        <th class="small">{{ day }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for u in users %}
      <tr>
        <td>{{ u.name }}</td>
        {% for day in days %}
          <td>{{ "%.2f"|format(load[u.id][day]["actual"]) }}</td>
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>

<h3>Список задач</h3>
<table>
  <thead>
    <tr><th>ID</th><th>Задача</th><th>Исполнитель</th><th>Даты</th><th>План</th><th>Прогресс</th><th>Статус</th></tr>
  </thead>
  <tbody>
  {% for t in tasks %}
    <tr>
      <td>{{ t.id }}</td>
      <td>{{ t.title }}</td>
      <td>
        {% if t.assignee_id %}
            {{ user_map[t.assignee_id].name if t.assignee_id in user_map else "-" }}
        {% else %}
            -
        {% endif %}
      </td>
      <td class="small">{{ t.start_date }} → {{ t.end_date }}</td>
      <td>{{ "%.2f"|format(t.planned_hours or 0) }}</td>
      <td>{{ t.current_progress }}%</td>
      <td>{{ t.status }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
